<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://xamarin.com/schemas/2014/forms"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:Taskick.ViewModels;assembly=Taskick"
             xmlns:controls="clr-namespace:Taskick.Controls;assembly=Taskick" 
             xmlns:sh="http://sharpnado.com"
             BackgroundColor="{StaticResource AppBackgroundColor}"
             Title="To-Do"          
             x:Name="MyPage"
             x:Class="Flyout_Test.Views.ToDoPage">
    <ContentPage.BindingContext>
        <vm:ToDoPageViewModel/>
    </ContentPage.BindingContext>
    
    <ContentPage.Content>
        <StackLayout>
            <RefreshView Command="{Binding LoadGoalsCommand}" IsRefreshing="{Binding IsBusy, Mode=TwoWay}">
                <CollectionView ItemsSource="{Binding Goals}" SelectionMode="Single" SelectionChanged="OnCollectionViewSelectionChanged">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <StackLayout Padding="0,5,0,0">
                                <StackLayout IsVisible="{Binding IsDisplayedDueDateVisible}" Padding="35,0,0,-5">

                                    <Label Text="{Binding DisplayedDueDate}"
                                           FontFamily="{StaticResource BoldFont}"
                                           FontSize="{StaticResource LargeFontSize}"
                                           TextColor="{StaticResource Blue}"/>

                                </StackLayout>

                                <Grid VerticalOptions="Center" RowSpacing="0" HorizontalOptions="Center">

                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="4"/>
                                        <RowDefinition Height="1"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="1"/>
                                        <RowDefinition Height="5"/>
                                    </Grid.RowDefinitions>

                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="25"/>
                                        <ColumnDefinition Width="50"/>
                                        <ColumnDefinition Width="200"/>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="10"/>
                                        <ColumnDefinition Width="25"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <!-- 
                                        Creating doubles for all frames, labels, checkbox's, etc. 
                                        this is done to check if goal is completed or not, then assign
                                        properties like color and shadows accordingly                     
                                    -->

                                    <!-- Display if completed -->
                                    <controls:CustomFrame IsVisible="{Binding IsCompleted}"
                                                          CornerRadius="0,15,0,15"
                                                          Padding="0"
                                                          Grid.Row="1"
                                                          Grid.Column="1"
                                                          Grid.RowSpan="3"
                                                          Grid.ColumnSpan="3"
                                                          HasShadow="False"
                                                          VerticalOptions="FillAndExpand"
                                                          HorizontalOptions="FillAndExpand"
                                                          BackgroundColor="{StaticResource BluePressedColor}">
                                        <Grid>

                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="25"/>
                                                <ColumnDefinition Width="50"/>
                                                <ColumnDefinition Width="200"/>
                                                <ColumnDefinition Width="100"/>
                                                <ColumnDefinition Width="10"/>
                                                <ColumnDefinition Width="25"/>
                                            </Grid.ColumnDefinitions>

                                            <Label Grid.Column="0" Grid.ColumnSpan="3" Margin="0,0,37,0" BackgroundColor="{StaticResource DarkPressedColor}" />

                                        </Grid>
                                    </controls:CustomFrame>

                                    <Label IsVisible="{Binding IsCompleted}"
                                           Text="{Binding Title}"
                                           FontFamily="{StaticResource BoldFont}"
                                           FontSize="{StaticResource LargeFontSize}"
                                           TextColor="{StaticResource GreyPressedColor}"
                                           Grid.Column="2"
                                           Grid.Row="2"
                                           Grid.RowSpan="1"
                                           VerticalOptions="Center" />

                                    <Label IsVisible="{Binding IsCompleted}"
                                           Text="{Binding ExpValue, StringFormat='{0} EXP', Mode=TwoWay}"
                                           FontFamily="{StaticResource BoldFont}"
                                           FontSize="{StaticResource LargeFontSize}"
                                           TextColor="{StaticResource DarkPressedColor}"
                                           Grid.Column="3"
                                           Grid.Row="2"
                                           Grid.RowSpan="1"
                                           Margin="0,0,10,0"
                                           FontAttributes="Bold"
                                           HorizontalOptions="Center"
                                           VerticalOptions="Center" />

                                    <CheckBox IsVisible="{Binding IsCompleted}"
                                              ClassId="{Binding Id}"
                                              IsChecked="{Binding IsCompleted, Mode=TwoWay}"
                                              IsEnabled="{Binding IsCompleted, Converter={StaticResource Inverter}}"
                                              Color="{StaticResource BluePressedColor}"
                                              CheckedChanged="OnCheckBoxCheckedChanged"
                                              Grid.Column="1"
                                              Grid.Row="2"
                                              Grid.ColumnSpan="1"
                                              Margin="5,0,0,0"
                                              VerticalOptions="Center"
                                              HorizontalOptions="Center"/>
                                    
                                    <!-- Display if not completed -->
                                    <sh:Shadows IsVisible="{Binding IsCompleted, Converter={StaticResource Inverter}}"
                                                Padding="0"
                                                Grid.Row="1"
                                                Grid.Column="1" 
                                                Grid.RowSpan="3"
                                                Grid.ColumnSpan="3">
                                        <sh:Shadows.Shades>
                                            <sh:ImmutableShades>
                                                <sh:Shade BlurRadius="20"
                                                      Opacity="1" 
                                                      Offset="0,5"
                                                      Color="{StaticResource BottomGradient}" />
                                            </sh:ImmutableShades>
                                        </sh:Shadows.Shades>
                                        <controls:CustomFrame CornerRadius="0,15,0,15"
                                                              InputTransparent="True"
                                                              Padding="0"
                                                              Grid.Row="1"
                                                              Grid.Column="1"
                                                              Grid.RowSpan="3"
                                                              Grid.ColumnSpan="3"
                                                              HasShadow="False"
                                                              VerticalOptions="FillAndExpand"
                                                              HorizontalOptions="FillAndExpand"
                                                              BackgroundColor="{StaticResource TertiaryTextColor}">
                                            <Grid>

                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="25"/>
                                                    <ColumnDefinition Width="50"/>
                                                    <ColumnDefinition Width="200"/>
                                                    <ColumnDefinition Width="100"/>
                                                    <ColumnDefinition Width="10"/>
                                                    <ColumnDefinition Width="25"/>
                                                </Grid.ColumnDefinitions>

                                                <Label Grid.Column="0" Grid.ColumnSpan="3" Margin="0,0,37,0" BackgroundColor="{StaticResource BottomGradient}" />

                                            </Grid>
                                        </controls:CustomFrame>
                                    </sh:Shadows>

                                    <Label IsVisible="{Binding IsCompleted, Converter={StaticResource Inverter}}"
                                           Text="{Binding Title}"
                                           FontFamily="{StaticResource BoldFont}"
                                           FontSize="{StaticResource LargeFontSize}"
                                           Grid.Column="2"
                                           Grid.Row="2"
                                           Grid.RowSpan="1"
                                           VerticalOptions="Center" />

                                    <Label IsVisible="{Binding IsCompleted, Converter={StaticResource Inverter}}"
                                           Text="{Binding ExpValue, StringFormat='{0} EXP', Mode=TwoWay}"
                                           FontFamily="{StaticResource BoldFont}"
                                           FontSize="{StaticResource LargeFontSize}"
                                           TextColor="{StaticResource BottomGradient}"
                                           Grid.Column="3"
                                           Grid.Row="2"
                                           Grid.RowSpan="1"
                                           Margin="0,0,10,0"
                                           FontAttributes="Bold"
                                           HorizontalOptions="Center"
                                           VerticalOptions="Center" />

                                    <CheckBox IsVisible="{Binding IsCompleted, Converter={StaticResource Inverter}}"
                                              ClassId="{Binding Id}"
                                              IsChecked="{Binding IsCompleted, Mode=TwoWay}"
                                              IsEnabled="{Binding IsCompleted, Converter={StaticResource Inverter}}"
                                              CheckedChanged="OnCheckBoxCheckedChanged"
                                              Grid.Column="1"
                                              Grid.Row="2"
                                              Grid.ColumnSpan="1"
                                              Margin="5,0,0,0"
                                              VerticalOptions="Center"
                                              HorizontalOptions="Center"/>
                                </Grid>
                            </StackLayout>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </RefreshView>

            <Button Text="Add Task" Command="{Binding GoToAddGoalPageCommand}" ></Button>

        </StackLayout>
    </ContentPage.Content>
</ContentPage>